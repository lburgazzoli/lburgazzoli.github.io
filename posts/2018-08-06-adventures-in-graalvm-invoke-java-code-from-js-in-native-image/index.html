<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=content-type content="text/html"><meta name=viewport content="width=device-width,initial-scale=1"><title itemprop=name>Adventures in GraalVM: invoke Java code from JS in native-image | Luca Burgazzoli</title>
<meta property="og:title" content="Adventures in GraalVM: invoke Java code from JS in native-image | Luca Burgazzoli"><meta name=twitter:title content="Adventures in GraalVM: invoke Java code from JS in native-image | Luca Burgazzoli"><meta itemprop=name content="Adventures in GraalVM: invoke Java code from JS in native-image | Luca Burgazzoli"><meta name=application-name content="Adventures in GraalVM: invoke Java code from JS in native-image | Luca Burgazzoli"><meta property="og:site_name" content=".: LB :."><meta name=description content="        Yet another software developer.
        Ideas are my own.
        "><meta itemprop=description content="        Yet another software developer.
        Ideas are my own.
        "><meta property="og:description" content="        Yet another software developer.
        Ideas are my own.
        "><meta name=twitter:description content="        Yet another software developer.
        Ideas are my own.
        "><meta property="og:locale" content="en-us"><meta name=language content="en-us"><link rel=alternate hreflang=en-us href=https://lburgazzoli.github.io/posts/2018-08-06-adventures-in-graalvm-invoke-java-code-from-js-in-native-image/ title><meta itemprop=image content="https://lburgazzoli.github.io/"><meta property="og:image" content="https://lburgazzoli.github.io/"><meta name=twitter:image content="https://lburgazzoli.github.io/"><meta name=twitter:image:src content="https://lburgazzoli.github.io/"><meta property="og:type" content="article"><meta property="og:article:published_time" content=2018-08-06T00:00:00Z><meta property="article:published_time" content=2018-08-06T00:00:00Z><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"Adventures in GraalVM: invoke Java code from JS in native-image","author":{"@type":"Person","name":""},"datePublished":"2018-08-06","description":"","wordCount":264,"mainEntityOfPage":"True","dateModified":"2018-08-06","image":{"@type":"imageObject","url":""},"publisher":{"@type":"Organization","name":"Luca Burgazzoli"}}</script><meta name=generator content="Hugo 0.126.1"><link rel=canonical href=https://lburgazzoli.github.io/posts/2018-08-06-adventures-in-graalvm-invoke-java-code-from-js-in-native-image/><link href=/style.min.d43bc6c79baa87f006efb2b92be952faeedeb1a3ab626c1d6abda52eae049355.css rel=stylesheet><link href=/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css rel=stylesheet><link rel=apple-touch-icon sizes=180x180 href=/icons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/icons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/icons/favicon-16x16.png><link rel=mask-icon href=/icons/safari-pinned-tab.svg><link rel="shortcut icon" href=/favicon.ico><link rel=manifest href=https://lburgazzoli.github.io/site.webmanifest><meta name=msapplication-config content="/browserconfig.xml"><meta name=msapplication-TileColor content="#2d89ef"><meta name=theme-color content="#434648"><link rel=icon type=image/svg+xml href=/icons/favicon.svg></head><body data-theme=dark class=notransition><script src=/js/theme.min.8961c317c5b88b953fe27525839672c9343f1058ab044696ca225656c8ba2ab0.js integrity="sha256-iWHDF8W4i5U/4nUlg5ZyyTQ/EFirBEaWyiJWVsi6KrA="></script><div class=navbar role=navigation><nav class=menu aria-label="Main Navigation"><a href=https://lburgazzoli.github.io/ class=logo><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><title>Home</title><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
</a><input type=checkbox id=menu-trigger class=menu-trigger>
<label for=menu-trigger><span class=menu-icon><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentcolor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7H3.40726"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M.5 12.5V1.5c0-.552285.447715-1 1-1h11C13.0523.5 13.5.947715 13.5 1.5v11C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C.947715 13.5.5 13.0523.5 12.5z"/></svg></span></label><div class=trigger><ul class=trigger-container><li><a class=menu-link href=/>Home</a></li><li><a class="menu-link active" href=/posts/>Posts</a></li><li><a class=menu-link href=/about/>About</a></li><li class=menu-separator><span>|</span></li></ul><a id=mode href=#><svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg><svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg></a></div></nav></div><div class="wrapper post"><main class=page-content aria-label=Content><article><header class=header><h1 class=header-title>Adventures in GraalVM: invoke Java code from JS in native-image</h1><div class=post-meta><time datetime=2018-08-06T00:00:00+00:00 itemprop=datePublished>Aug 6, 2018</time></div></header><div class=page-content><div class=paragraph><p>Thre’s a lot of interest about GraalVM’s native-image recently so I give it a try but instead of "just" trying to compile some java code to a native binary I went to the edge trying to make the native binary extensible via JavaScript.</p></div><div class=paragraph><p>In a Java application make some java objects available to the JS runtime is trivial and you only need to do something like:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>try(Context context = Context.create()) {
    MyBean bean = new MyBean();

    context.getBindings(&#34;js&#34;).putMember(&#34;bean&#34;, bean);
    context.eval(&#34;js&#34;, &#34;bean.saySomething()&#34;)
}</code></pre></div></div><div class=paragraph><p>But when a native binary is generated this does not work anymore as GraalVM as of RC5 does not yet support reflective access to Java code from JS (and other languages) so we need to use some proxy object GraalVM SDK provides.</p></div><div class=paragraph><p>The javadoc for the proxy packages is:</p></div><div class=literalblock><div class=content><pre>http://www.graalvm.org/sdk/javadoc/org/graalvm/polyglot/proxy/package-summary.html</pre></div></div><div class=paragraph><p>So let’s write an example:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>try(Context ctx = Context.create()) {
    final Map&lt;String, Object&gt; proxy = new HashMap&lt;&gt;(); // <b class=conum>(1)</b>
    proxy.put(&#34;sayHello&#34;, new ProxyExecutable() { // <b class=conum>(2)</b>
        @Override
        public Object execute(Value... arguments) {
            if (arguments.length != 1) {
                throw new IllegalArgumentException();
            }

            System.out.printf(&#34;Hello, %s\n&#34;, arguments[0].asString());
            return null;
        }
    });

    ProxyObject bean = ProxyObject.fromMap(proxy); // <b class=conum>(3)</b>
    ctx.getBindings(&#34;js&#34;).putMember(&#34;bean&#34;, bean); // <b class=conum>(4)</b>

    ctx.eval(&#34;js&#34;, &#34;bean.sayHello(&#39;World!&#39;)&#34;); // <b class=conum>(5)</b>
}</code></pre></div></div><div class="colist arabic"><ol><li><p>Use a map to describe our bean</p></li><li><p>Wrap the function we want to invoke using a <code><code>ProxyExecutable</code></code> which mimics a guest language objects that are executable</p></li><li><p>Wrap our map using <code><code>ProxyObject</code></code> builtin <code><code>fromMap</code></code></p></li><li><p>Bind our proxy to a variable named <code><code>bean</code></code> the scripting engine can the access</p></li><li><p>Finally Invoke our <code><code>ProxyExecutable</code></code> from JS</p></li></ol></div><div class="admonitionblock caution"><table><tbody><tr><td class=icon><div class=title>Caution</div></td><td class=content><div class=paragraph><p>I’m unable to have a stable base for going further because of the following issues:</p></div><div class=ulist><ul><li><p><a href=https://github.com/oracle/graal/issues/594 class=bare>https://github.com/oracle/graal/issues/594</a></p></li><li><p><a href=https://github.com/oracle/graal/issues/592 class=bare>https://github.com/oracle/graal/issues/592</a></p></li></ul></div></td></tr></tbody></table></div></div></article></main></div><footer class=footer><span class=footer_item></span>&nbsp;<div class=footer_social-icons><a href=https://github.com/lburgazzoli target=_blank rel="noopener noreferrer me" title=Github><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a href=https://twitter.com/lburgazzoli target=_blank rel="noopener noreferrer me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg>
</a><a href=https://www.linkedin.com/in/lucaburgazzoli target=_blank rel="noopener noreferrer me" title=Linkedin><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg>
</a><a href=index.xml target=_blank rel="noopener noreferrer me" title=RSS><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div><small class=footer_copyright>© 2024 .: LB :..
Powered by <a href=https://github.com/hugo-sid/hugo-blog-awesome target=_blank rel=noopener>Hugo blog awesome</a>.</small></footer><a href=# title="Go to top" id=totop><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentcolor" stroke="currentcolor" viewBox="0 96 960 960"><path d="M283 704.739 234.261 656 480 410.261 725.739 656 677 704.739l-197-197-197 197z"/></svg>
</a><script src=https://lburgazzoli.github.io/js/main.min.35f435a5d8eac613c52daa28d8af544a4512337d3e95236e4a4978417b8dcb2f.js integrity="sha256-NfQ1pdjqxhPFLaoo2K9USkUSM30+lSNuSkl4QXuNyy8="></script></body></html>