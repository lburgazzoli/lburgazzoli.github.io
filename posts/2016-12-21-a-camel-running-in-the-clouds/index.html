<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=content-type content="text/html"><meta name=viewport content="width=device-width,initial-scale=1"><title itemprop=name>A camel running in the clouds | Luca Burgazzoli</title><meta property="og:title" content="A camel running in the clouds | Luca Burgazzoli"><meta name=twitter:title content="A camel running in the clouds | Luca Burgazzoli"><meta itemprop=name content="A camel running in the clouds | Luca Burgazzoli"><meta name=application-name content="A camel running in the clouds | Luca Burgazzoli"><meta property="og:site_name" content=".: LB :."><meta name=description content="        Yet another software developer.
        Ideas are my own.
        "><meta itemprop=description content="        Yet another software developer.
        Ideas are my own.
        "><meta property="og:description" content="        Yet another software developer.
        Ideas are my own.
        "><meta name=twitter:description content="        Yet another software developer.
        Ideas are my own.
        "><meta property="og:locale" content="en-us"><meta name=language content="en-us"><meta itemprop=image content="https://lburgazzoli.github.io"><meta property="og:image" content="https://lburgazzoli.github.io"><meta name=twitter:image content="https://lburgazzoli.github.io"><meta name=twitter:image:src content="https://lburgazzoli.github.io"><meta property="og:type" content="article"><meta property="og:article:published_time" content="2016-12-21T00:00:00Z"><meta property="article:published_time" content="2016-12-21T00:00:00Z"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"A camel running in the clouds","author":{"@type":"Person","name":""},"datePublished":"2016-12-21","description":"","wordCount":620,"mainEntityOfPage":"True","dateModified":"2016-12-21","image":{"@type":"imageObject","url":""},"publisher":{"@type":"Organization","name":"Luca Burgazzoli"}}</script><meta name=generator content="Hugo 0.111.3"><link rel=canonical href=https://lburgazzoli.github.io/posts/2016-12-21-a-camel-running-in-the-clouds/><link href=/style.min.e8353c8bf6aa84457d3c7f65980d94548f249c91e6b37b15b9f1c7e13ceed431.css rel=stylesheet><link href=/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css rel=stylesheet><link rel=apple-touch-icon sizes=180x180 href=/icons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/icons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/icons/favicon-16x16.png><link rel=mask-icon href=/icons/safari-pinned-tab.svg><link rel="shortcut icon" href=/favicon.ico><link rel=manifest href=https://lburgazzoli.github.io/site.webmanifest><meta name=msapplication-config content="/browserconfig.xml"><meta name=msapplication-TileColor content="#2d89ef"><meta name=theme-color content="#434648"><link rel=icon type=image/svg+xml href=/icons/favicon.svg></head><body data-theme=dark class=notransition><script src=/js/themeLoader.min.3c3396ae9effcbd02e7064baa7b435ffe6560bcd7fec0b428a470d3a128f2220.js></script><div class=navbar role=navigation><nav class=menu aria-label="Main Navigation"><a href=https://lburgazzoli.github.io/ class=logo><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><title>Home</title><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></a><input type=checkbox id=menu-trigger class=menu-trigger>
<label for=menu-trigger><span class=menu-icon><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentcolor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7H3.40726"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M.5 12.5V1.5c0-.552285.447715-1 1-1h11C13.0523.5 13.5.947715 13.5 1.5v11C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C.947715 13.5.5 13.0523.5 12.5z"/></svg></span></label><div class=trigger><ul class=trigger-container><li><a class=menu-link href=/>Home</a></li><li><a class="menu-link active" href=/posts/>Posts</a></li><li><a class=menu-link href=/about/>About</a></li><li class=menu-separator><span>|</span></li></ul><a id=mode href=#><svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg><svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg></a></div></nav></div><div class="wrapper post"><main class=page-content aria-label=Content><article><header class=header><h1 class=header-title>A camel running in the clouds</h1><div class=post-meta><time datetime=2016-12-21T00:00:00+00:00 itemprop=datePublished>Dec 21, 2016</time></div></header><div class=page-content><div class=sect1><h2 id=_camel_and_spring_boot>Camel and Spring Boot</h2><div class=sectionbody><div class=paragraph><p>Camel supports Spring Boot since Camel 2.15 but in the latest release we have improved Camel to make it a first class citizen of Spring Boot, some notables improvements available as of Camel 2.18 are:</p></div><div class=ulist><ul><li><p>spring boot starters</p></li><li><p>spring boot auto configuration</p></li><li><p>spring boot healt check</p></li></ul></div><div class=paragraph><p>In Camel 2.19 we’ll furter improve the integration between Camel and Spring Boot and it will include support for Spring Cloud.</p></div><div class=sect2><h3 id=_meet_camel_spring_cloud>Meet Camel Spring Cloud</h3><div class=paragraph><p>Spring Cloud <sup class=footnote>[<a id=_footnoteref_1 class=footnote href=#_footnotedef_1 title="View footnote.">1</a>]</sup> provides an implementation of some common pattern in distributed system like:</p></div><div class=ulist><ul><li><p>configuration management</p></li><li><p>service discovery</p></li><li><p>load balancing</p></li></ul></div><div class=paragraph><p>The initial support for Spring Cloud in Camel leverages service discovery and load balancing to provide an implementation of the ServiceCall EIP <sup class=footnote>[<a id=_footnoteref_2 class=footnote href=#_footnotedef_2 title="View footnote.">2</a>]</sup> so that you can easilly call remote services with minimal efforts.</p></div><div class=paragraph><p>Let’s build a simple load balanced ServiceCall in OpenShift</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><div class=title>Note</div></td><td class=content><div class=paragraph><p>I’ll show the relevant parts here, full code is available on <a href=https://github.com/lburgazzoli/camel-cloud>github</a></p></div></td></tr></tbody></table></div><div class=sect3><h4 id=_bill_of_materials>Bill of materials</h4><div class=ulist><ul><li><p>Minishift <sup class=footnote>[<a id=_footnoteref_3 class=footnote href=#_footnotedef_3 title="View footnote.">3</a>]</sup></p></li><li><p>Apache Maven</p></li><li><p>Fabri8 Maven Plugin <sup class=footnote>[<a id=_footnoteref_4 class=footnote href=#_footnotedef_4 title="View footnote.">4</a>]</sup></p></li><li><p>Spring Boot</p></li><li><p>Spring Cloud Commons</p></li><li><p>Spring Cloud Netflix</p></li><li><p>Spring Cloud Kubernetes</p></li><li><p>Apache Camel 2.19.0-SNAPSHOT</p></li></ul></div><div class="admonitionblock important"><table><tbody><tr><td class=icon><div class=title>Important</div></td><td class=content><div class=paragraph><p>Spring Cloud Kubernetes is now part of Spring Cloud Incubator <sup class=footnote>[<a id=_footnoteref_5 class=footnote href=#_footnotedef_5 title="View footnote.">5</a>]</sup> but we are still using the version from fabric8io <sup class=footnote>[<a id=_footnoteref_6 class=footnote href=#_footnotedef_6 title="View footnote.">6</a>]</sup> to let the migration process to complete</p></div></td></tr></tbody></table></div></div><div class=sect3><h4 id=_set_up_a_simple_rest_web_service>Set up a simple REST Web Service</h4><div class=paragraph><p>Thanks to Spring Boot, writing a simple REST Web Service is really trivial:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>@RestController
public class ServiceController {
    @RequestMapping(&#34;/hello&#34;)
    public String hello() {
        return &#34;Hello from &#34; + System.getenv(&#34;POD_NAME&#34;);
    }
}</code></pre></div></div><div class=paragraph><p>Now, let’s write a OpenShift descriptor to start two replicas of the Web Service we have created:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-yaml data-lang=yaml>spec:
  replicas: 2
  template:
    spec:
      containers:
        -
          env:
          - name: SPRING_APPLICATION_NAME
            value: camel-cloud-svc
          - name: POD_NAME
            valueFrom:
              fieldRef:
                fieldPath: metadata.name</code></pre></div></div><div class=paragraph><p>Thanks to the Fabric8 Maven Plugin, deploying our Web Service is a matter of a single command:</p></div><div class=listingblock><div class=content><pre class=highlight><code>$ mvn fabric8:deploy

...

$ oc get pods
NAME                          READY     STATUS      RESTARTS   AGE
camel-cloud-svc-1-deploy      1/1       Running     0          27s
camel-cloud-svc-1-ojyy6       0/1       Running     0          24s
camel-cloud-svc-1-sbkbi       0/1       Running     0          24s
camel-cloud-svc-s2i-2-build   0/1       Completed   0          55s</code></pre></div></div><div class=paragraph><p>If you looks at the endpoints you’ll see the internal addresses our Web Service is listening to and its name:</p></div><div class=listingblock><div class=content><pre class=highlight><code>$ oc get endpoints
NAME              ENDPOINTS                         AGE
camel-cloud-svc   172.17.0.3:8080,172.17.0.5:8080   2m</code></pre></div></div></div><div class=sect3><h4 id=_set_up_a_simple_camel_route>Set up a simple Camel Route</h4><div class=paragraph><p>Thanks to Spring Boot, Spring Cloud and Camel Spring Cloud writing a simple route that invokes the Web Services we have deployed above is really easy:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-java data-lang=java>@Configuration
public class ConsumerConfiguration {
    @Bean
    public RouteBuilder routeBuilder() {
        return new RouteBuilder() {
            @Override
            public void configure() throws Exception {
                from(&#34;timer:service-call?period=1s&#34;)
                    .serviceCall(&#34;camel-cloud-svc/hello&#34;) <b class=conum>(1)</b>
                    .convertBodyTo(String.class)
                        .to(&#34;log:service.consumer?level=INFO&amp;showAll=tru&amp;multiline=true&#34;);
            }
        };
    }
}</code></pre></div></div><div class="colist arabic"><ol><li><p>The only thing you need to configure the Service Call EIP: the name of the service and its context path</p></li></ol></div><div class=paragraph><p>Thanks to the Fabric8 Maven Plugin, running our Web Service Consumer is a matter of a single command:</p></div><div class=listingblock><div class=content><pre class=highlight><code>$ mvn fabric8:run

...

[INFO] F8: 2016-12-21 17:35:25.473  INFO 1 --- [://service-call] service.consumer : Exchange[
[INFO] F8: , ExchangePattern: InOnly
[INFO] F8: , BodyType: String
[INFO] F8: , Body: Hello from camel-cloud-svc-1-sbkbi <b class=conum>(1)</b>
[INFO] F8: ]
[INFO] F8: 2016-12-21 17:35:25.563  INFO 1 --- [://service-call] service.consumer : Exchange[
[INFO] F8: , ExchangePattern: InOnly
[INFO] F8: , BodyType: String
[INFO] F8: , Body: Hello from camel-cloud-svc-1-ojyy6 <b class=conum>(2)</b>
[INFO] F8: ]</code></pre></div></div><div class="colist arabic"><ol><li><p>Web Service invoked on POD camel-cloud-svc-1-sbkbi</p></li><li><p>Web Service invoked on POD camel-cloud-svc-1-ojyy6</p></li></ol></div></div><div class=sect3><h4 id=_wrap_up>Wrap up</h4><div class=paragraph><p>What’s happen under the hood ?</p></div><div class="olist arabic"><ol class=arabic><li><p>Spring Cloud Kubernetes automatically creates a DiscoveryClient which is used to lookup services by name</p></li><li><p>Spring Cloud Commons/Netflix automatically creates a LoadBalancerClient which leverages Netflix’s Ribbon for load balancing</p></li><li><p>Camel Spring Cloud automatically configure the SerivceCall EIP to use the LoadBalancerClient created by Spring Cloud</p></li></ol></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><div class=title>Warning</div></td><td class=content>This is a work in progress so things may change in the next future.</td></tr></tbody></table></div></div></div></div></div><div id=footnotes><hr><div class=footnote id=_footnotedef_1><a href=#_footnoteref_1>1</a>. <a href=http://projects.spring.io/spring-cloud/ class=bare>http://projects.spring.io/spring-cloud/</a></div><div class=footnote id=_footnotedef_2><a href=#_footnoteref_2>2</a>. <a href=http://camel.apache.org/servicecall-eip.html class=bare>http://camel.apache.org/servicecall-eip.html</a></div><div class=footnote id=_footnotedef_3><a href=#_footnoteref_3>3</a>. <a href=https://github.com/minishift/minishift class=bare>https://github.com/minishift/minishift</a></div><div class=footnote id=_footnotedef_4><a href=#_footnoteref_4>4</a>. <a href=https://maven.fabric8.io/ class=bare>https://maven.fabric8.io/</a></div><div class=footnote id=_footnotedef_5><a href=#_footnoteref_5>5</a>. <a href=https://github.com/spring-cloud-incubator/spring-cloud-kubernetes class=bare>https://github.com/spring-cloud-incubator/spring-cloud-kubernetes</a></div><div class=footnote id=_footnotedef_6><a href=#_footnoteref_6>6</a>. <a href=https://github.com/fabric8io/spring-cloud-kubernetes/ class=bare>https://github.com/fabric8io/spring-cloud-kubernetes/</a></div></div></div></article></main></div><footer class=footer><span class=footer_item></span>&nbsp;<div class=footer_social-icons><a href=https://github.com/lburgazzoli target=_blank rel="noopener noreferrer me" title=Github><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a href=https://twitter.com/lburgazzoli target=_blank rel="noopener noreferrer me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a><a href=https://www.linkedin.com/in/lucaburgazzoli target=_blank rel="noopener noreferrer me" title=Linkedin><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a><a href=index.xml target=_blank rel="noopener noreferrer me" title=RSS><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div><small class=footer_copyright>© 2023 .: LB :..
Powered by <a href=https://github.com/hugo-sid/hugo-blog-awesome target=_blank rel="noreferrer noopener">Hugo blog awesome</a>
theme on
<a href=https://gohugo.io target=_blank rel="noreferrer noopener">Hugo</a>.</small></footer><a href=# title="Go to top" id=totop><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentcolor" stroke="currentcolor" viewBox="0 96 960 960"><path d="M283 704.739 234.261 656 480 410.261 725.739 656 677 704.739l-197-197-197 197z"/></svg></a><script src=https://lburgazzoli.github.io/js/script.min.46bd451490183d25f475c182f8fe773c1c787124cec75969e37c871d76aa151f.js integrity="sha256-Rr1FFJAYPSX0dcGC+P53PBx4cSTOx1lp43yHHXaqFR8="></script></body></html>